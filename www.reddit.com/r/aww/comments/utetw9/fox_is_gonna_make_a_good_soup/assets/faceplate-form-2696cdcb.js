import{a8 as t,a9 as e,_ as i,e as s,r as n,$ as a,s as r,E as o,m as l,aa as c,ab as d,ac as h,ad as u,n as p,ae as f,af as m,ag as g,ah as v,ai as b,c as y,aj as _,ak as E,al as S,am as k}from"./shell-f8d273fb.js";const w=t(),C=function(){const t=new WeakMap;let e=!1;return{get isDirty(){return e},getRegistration:(t,e,i)=>({target:t,key:e,value:i}),register({target:i,key:s,value:n}){const a=t.get(i);if(a&&!a.has(s))a.set(s,n);else{if(a)throw new Error(`Cannot register value for key ${s}; something is already registered!`);t.set(i,new Map([[s,n]]))}e=!0},unregister({target:i,key:s,value:n}){const a=t.get(i);a&&a.get(s)===n&&(a.delete(s),e=!0)},getRegisteredElements(i){const s=t.get(i);return e=!1,s},unregisterAll(i){t.delete(i),e=!0}}}(),V=e(),A=V.registerAncestorClass,I=V.connectToAncestor;class M{constructor(t,e,i,s,n,a,r,o,l,c){this.valueMissing=t,this.typeMismatch=e,this.patternMismatch=i,this.tooLong=s,this.tooShort=n,this.rangeUnderflow=a,this.rangeOverflow=r,this.stepMismatch=o,this.badInput=l,this.customError=c}}class F{constructor(t){this.submissionValue=null,this.constraintsSuffered={},this.customValidityMessage="",this.validityMessage="",this.validationAnchor=null,this.target=t,this.input=document.createElement("input"),this.input.className="faceplate-internal-input",this.input.tabIndex=-1,this.input.style.opacity="0",this.input.style.width="1px",this.input.style.height="100%",this.input.style.padding="0",this.input.style.border="0",this.input.style.pointerEvents="none"}_connect(t){t?(this._form=t,w.register(t,this.target)):this._form=void 0}_disconnect(){this._form&&(w.unregister(this._form,this.target),this._form=void 0)}getFormValue(){return this.submissionValue}setFormValue(t){this.submissionValue=t}get form(){return this._form}isSufferingFromItsConstraints(){for(const t in this.constraintsSuffered)if(this.constraintsSuffered[t])return!0;return!1}setValidity(t,e,i=null){if(t&&Object.keys(t).length)for(const e in t)this.constraintsSuffered[e]=t[e];else this.constraintsSuffered=t||{};const s=!!e&&this.isSufferingFromItsConstraints();if(t&&Object.prototype.hasOwnProperty.call(t,"customError")){const t=this.constraintsSuffered.customError&&e?e:"";this.customValidityMessage=t}else this.validationAnchor=i,this.validityMessage=s&&e?e:"";(this.validationAnchor||this.input).setCustomValidity(this.validationMessage),this.target.setAttribute("faceplate-validity",s?"invalid":"valid")}get willValidate(){return!(this.target.disabled||null===this.submissionValue)}get validity(){const t=this.constraintsSuffered;return new M(!!t.valueMissing,!!t.typeMismatch,!!t.patternMismatch,!!t.tooLong,!!t.tooShort,!!t.rangeUnderflow,!!t.rangeOverflow,!!t.stepMismatch,!!t.badInput,!!t.customError)}get validationMessage(){return this.customValidityMessage||this.validityMessage}dispatchInvalidEvent(){const t=new Event("invalid",{bubbles:!0,cancelable:!0});return this.target.dispatchEvent(t),t}checkValidity(){return!this.isSufferingFromItsConstraints()||(this.dispatchInvalidEvent(),!1)}reportValidity(){if(this.isSufferingFromItsConstraints()){if(!this.dispatchInvalidEvent().defaultPrevented){(this.validationAnchor||this.input).reportValidity()}return!1}return!0}}const L=Symbol("mixins/form-association");function D(t){return!!t&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement||L in t.constructor)}const O=new Set(["checkbox","radio"]);function x(t){return D(t)&&O.has(t.type)}const R=new Set(["radio"]);function P(t){return x(t)&&R.has(t.type)}const T=t(),j=new MutationObserver((t=>{for(const e of t){if("attributes"!==e.type||"disabled"!==e.attributeName||!(e.target instanceof HTMLFieldSetElement))continue;const t=T.getRegisteredElements(e.target);if(t)for(const i of t)i.formDisabledCallback&&i.formDisabledCallback(i.disabled||e.target.disabled)}}));class q extends(function(t){if(L in t)return t;class e extends t{constructor(){super(...arguments),this._internals=new F(this)}connectedCallback(){super.connectedCallback&&super.connectedCallback(),I(this).then((t=>{if(!t||!this.isConnected)return;this._internals._connect(t);let e=this;for(;e.parentElement&&(e=e.parentElement,e!==t)&&!(e instanceof HTMLLegendElement);)if(e instanceof HTMLFieldSetElement){this._fieldSet=e;T.getRegisteredElements(e)||j.observe(e,{attributes:!0}),T.register(e,this);break}this.formDisabledCallback&&this.formDisabledCallback(this.disabled)}))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),this._internals._disconnect(),this._fieldSet&&(T.unregister(this._fieldSet,this),this._fieldSet=void 0)}get value(){return this._internals.getFormValue()}set value(t){this._internals.setFormValue(t)}get form(){return this._internals.form}get name(){return this.getAttribute("name")||""}get disabled(){return this.hasAttribute("disabled")||!(!this._fieldSet||!this._fieldSet.disabled)}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled"),this.formDisabledCallback&&this.formDisabledCallback(t||!(!this._fieldSet||!this._fieldSet.disabled))}get type(){return this.localName}get validity(){return this._internals.validity}get validationMessage(){return this._internals.validationMessage}get willValidate(){return this._internals.willValidate}checkValidity(){return this._internals.checkValidity()}reportValidity(){return this._internals.reportValidity()}setCustomValidity(t){this._internals.setValidity({customError:!!t},t)}}return e[L]=!0,e}(r)){constructor(){super(),this.ariaDisabled="false",this.addEventListener("focus",(()=>{const t=new FocusEvent("focusin",{bubbles:!0});this.dispatchEvent(t)}))}static get styles(){return n`:host{display:inline-block;position:relative}:host([aria-disabled=true]){cursor:not-allowed;opacity:.5}:host([faceplate-validity=invalid]){border-color:var(--color-danger-content)}.faceplate-internal-input{position:absolute;left:50%;bottom:0}`}get disabled(){return super.disabled}set disabled(t){super.disabled=t}render(){return a` ${this._internals.input} `}formDisabledCallback(t){this.ariaDisabled=t?"true":"false"}}function H(){return q}i([s({type:Boolean,reflect:!0})],q.prototype,"disabled",null),i([s({type:String,attribute:"aria-disabled",reflect:!0})],q.prototype,"ariaDisabled",void 0);class $ extends q{constructor(){super(...arguments),this.required=!1,this.name="",this.initialized=!1,this._events=new o(this),this.ariaRole="checkbox",this._checked=!1,this._handleClick=this._events.define("click",(()=>{this.disabled||this.handleInteraction()})),this._handleKeydown=this._events.define("keydown",(t=>{this.disabled||"Space"===t.code&&(t.stopPropagation(),t.preventDefault(),this.handleInteraction())}))}get checked(){return this._checked}set checked(t){const e=this._checked;t!==e&&(this._internals.setFormValue(t?this.getAttribute("value")||"on":null),this._checked=t,t?this.setAttribute("aria-checked","true"):this.removeAttribute("aria-checked"),this.hasAttribute("required")&&!this.checked?this._internals.setValidity({valueMissing:!0},l(`This ${this.ariaRole} must be on`)):this._internals.setValidity(),this.requestUpdate("checked",e))}static get styles(){return[super.styles,n`:host(:not(faceplate-switch-input)){height:var(--size-md)}:host{display:flex;align-items:center}label{font:var(--font-14-20-regular);color:var(--color-neutral-content-strong);margin-left:var(--spacer-2xs)}.icon{border:var(--line-md) solid transparent;height:var(--size-md);font-size:var(--size-md)}:host([checked]) .icon,:host([indeterminate]) .icon{display:inline-block;color:var(--color-primary-background)}:host(:hover) .icon{color:var(--color-primary-background-hover)}:host([faceplate-validity=invalid]) .icon{color:var(--color-danger-content);pointer-events:none}:host([aria-disabled=true]) .icon{color:var(--color-neutral-content-disabled);pointer-events:none}:host([required]) label::after{position:absolute;color:var(--color-danger-content);content:'*'}:host(:focus) .icon{border-color:var(--color-global-focus,transparent);outline:0}:host(:focus){outline:0}:host(:focus:not(:focus-visible)) .icon{border-color:transparent}`]}connectedCallback(){super.connectedCallback(),this.initialized||(this.initialized=!0,this.setAttribute("role",this.ariaRole),this.setAttribute("tabindex","0"))}formDisabledCallback(t){super.formDisabledCallback(t),t?this.removeAttribute("tabindex"):this.setAttribute("tabindex","0")}render(){return a` ${super.render()} <label> <slot></slot> </label> `}handleInteraction(){const t=new InputEvent("input",{bubbles:!0});this.dispatchEvent(t)}}function z(t){const e={};for(const i of t){const[t,s]=i;if(s instanceof File)throw c(t);Object.prototype.hasOwnProperty.call(e,t)?Array.isArray(e[t])?e[t].push(s):e[t]=[e[t],s]:e[t]=s}return e}function U(t){return t instanceof HTMLElement&&Object.prototype.hasOwnProperty.call(t.dataset,"faceplateConstraint")}function N(t,e){const i=k("_faceplate-validation-change",{bubbles:!0,cancelable:!1,composed:!1,detail:{input:e,message:e.validationMessage,name:e.name}});t.dispatchEvent(i)}function B(t){return y("faceplate-alert",{level:b.error,message:l("Form submission failed"),meta:t.toString()})}i([s({type:Boolean})],$.prototype,"required",void 0),i([s({type:String})],$.prototype,"name",void 0),i([s({type:Boolean,reflect:!0})],$.prototype,"checked",null);const W={[d.UrlEncoded]:h,[d.JSON]:function(t){return JSON.stringify(z(t))},[d.FormData]:t=>t};let J=class extends r{constructor(){super(...arguments),this.accept="text/vnd.reddit.partial+html, application/json",this.enctype=d.UrlEncoded,this.action="",this.disabled=!1,this.method=f.Post,this.target="",this.partialMode=m.Append,this.novalidate=!1,this._events=new o(this),this.formSubmissionInProgress=!1,this.rulesDidChange=!1,this.focusedInputForValiditySinceLastSubmit=!1,this._formInputDirty=!0,this._elements={},this._validationObserverCount=0,this._asyncInputOperations=0,this.requester=g,this.encoders=W,this._handleInput=this._events.define("input",(()=>{this._formInputDirty=!0})),this._handleFormSubmit=this._events.define("submit",(t=>{const e=t.target;if(!(e&&e instanceof HTMLFormElement))return;t.preventDefault();const i=v(t);this.submit(e.action,void 0,i)})),this._handleClick=this._events.define("click",(t=>{const e=v(t);e&&(t.preventDefault(),this.submit(this.action,void 0,e))})),this._handleFocusIn=this._events.define("focusin",(t=>{if(D(t.target)&&U(t.target))if(this.formSubmissionInProgress){const e=this;t.target.addEventListener("input",(function t(i){var s;e.validateElementAgainstRules(i.target)&&(null===(s=i.target)||void 0===s||s.removeEventListener("input",t))}))}else t.target.setCustomValidity("")})),this._handleFocusOut=this._events.define("focusout",(t=>{D(t.target)&&(U(t.target)&&this.validateElementAgainstRules(t.target),this._validationObserverCount&&N(this,t.target))})),this._handleFaceplateAlert=this._events.define("faceplate-alert",(t=>{const{level:e,name:i,message:s}=t.detail;e===b.error&&i&&s&&this.invalidateFieldWithMessage(i,s)&&(t.target.remove(),t.stopPropagation())})),this._handleRegister=this._events.define("_faceplate-register-input",(t=>{t.stopImmediatePropagation(),t.detail.register(this)}))}get canSubmit(){return!(this.disabled||this.formSubmissionInProgress||this._asyncInputOperations>0)}get elements(){if(this._formInputDirty){this._elements={};for(const t of this.elementsIterator()){const{name:e}=t;if(e)if(e in this._elements){const i=this._elements[e];let s;Array.isArray(i)?(s=i,i.push(t)):(s=[i,t],s.value=P(i)&&i.checked?i.value:"",this._elements[e]=s),P(t)&&t.checked&&(s.value=t.value)}else this._elements[t.name]=t}this._formInputDirty=!1}return this._elements}static get styles(){return n`:host{display:block;margin-bottom:1rem}`}render(){return a` <slot></slot> `}addEventListener(t,e,i){super.addEventListener(t,e,i),"_faceplate-validation-change"===t&&(this._validationObserverCount+=1)}removeEventListener(t,e,i){super.removeEventListener(t,e,i),"_faceplate-validation-change"===t&&(this._validationObserverCount-=1)}async disableUntil(t){this._asyncInputOperations+=1;try{await t}finally{this._asyncInputOperations-=1}}invalidateFieldWithMessage(t,e){const i=this.querySelector(`[name="${t}"]`);return!!D(i)&&(i.setCustomValidity(e),this._validationObserverCount&&N(this,i),e&&i.addEventListener("input",(function t(){i.setCustomValidity(""),i.removeEventListener("input",t)})),e&&!this.focusedInputForValiditySinceLastSubmit&&(this.focusedInputForValiditySinceLastSubmit=!0,this.reportFieldValidity(i)),!0)}reportFieldValidity(t){const e=t.reportValidity();if(!e&&null===t.offsetParent){const e=y("faceplate-alert",{level:b.error,message:l("Validation error on hidden input"),meta:`"${t.name}": ${t.validationMessage}`});this.dispatchEvent(e)}return e}get targetElement(){return this.target&&document.querySelector(this.target)||this}async submit(t=this.action,e,i){var s,n;if(!this.canSubmit)return;this.formSubmissionInProgress=!0,this.focusedInputForValiditySinceLastSubmit=!1;try{const o=y("faceplate-submit");if(this.dispatchEvent(o),o.defaultPrevented)return;const l=this.buildRequest(e,i);if(!l)return;if("dialog"===l.method){const t=this.closest("faceplate-dialog");if(!t)throw new Error("Unable to find parent faceplate-dialog element to close with form submission");return t.close(l.body)}let c=this.enctype;if(i&&i.hasAttribute("formenctype")&&(c=i.getAttribute("formenctype")),"log"===l.method){const t=this.encoders[c];return console.log(t?t(l.body):l.body)}i&&i.hasAttribute("formaction")&&(t=i.getAttribute("formaction"));const d={enctype:c,encoders:this.encoders,credentials:this.credentials};try{for(var a,r=_(this.requester(t,l,d));!(a=await r.next()).done;){const t=a.value;if("faceplate-error"===t.type){const e=B(t.detail);this.dispatchEvent(e);break}if(this.dispatchEvent(t),"faceplate-response"===t.type){await this.handleResponse(t.detail.response);break}}}catch(t){s={error:t}}finally{try{a&&!a.done&&(n=r.return)&&await n.call(r)}finally{if(s)throw s.error}}}catch(t){const e=B(t);this.dispatchEvent(e)}finally{return void(this.formSubmissionInProgress=!1)}}validateElementAgainstRules(t){var e;if(!U(t))return!0;if(this.rulesDidChange){const t=y("faceplate-form-constraints-changed");this.dispatchEvent(t),this.rulesDidChange=!1}t.setCustomValidity("");const i=C.getRegisteredElements(this);if(!i)return!0;const s=null===(e=t.dataset.faceplateConstraint)||void 0===e?void 0:e.split(" ");if(!s||!s.length)return!0;for(const e of s){const s=i.get(e);if(!s){console.warn(`Skipping validation against unknown rule "${e}"`);continue}const n=t.value;if(null!==n&&!s.validate(n))return t.setCustomValidity(s.message),!1}return!0}*elementsIterator(){const t=this.querySelectorAll("input, textarea, select, output");for(let e=0;e<t.length;e++)yield t[e];const e=w.getRegisteredElements(this);e&&(yield*e)}buildRequest(t,e){const i=new FormData;!e&&arguments.length<3&&(e=v());const s=!(this.novalidate||e&&e.hasAttribute("formnovalidate"));for(const t of this.elementsIterator())if(D(t)){if(s&&(this.validateElementAgainstRules(t),!this.reportFieldValidity(t)))return null;if(t.disabled)continue;if(t.matches(":disabled"))continue;if(x(t)&&!t.checked)continue;const{name:e,value:n}=t;if(null===n)continue;if(n instanceof FormData){for(const t of n)i.append(t[0],t[1]);continue}if(!e)continue;if(t instanceof HTMLSelectElement&&t.multiple)for(const s of t.options)s.selected&&i.append(e,s.value);else if(t instanceof HTMLInputElement&&"file"===t.type){const s=t.files;if(s)for(const t of s)i.append(e,t)}else i.append(e,n)}if(t)for(const e of t)i.append(e.name,e.value);let n=this.method;return e&&(e.name&&e.value&&i.append(e.name,e.value),e.hasAttribute("formmethod")&&(n=u(e.getAttribute("formmethod")))),{body:i,method:n.toLowerCase(),headers:{Accept:this.accept}}}async handleResponse(t){const e=E(t);if("text/vnd.reddit.partial+html"===e){const e=await t.text(),i=this.targetElement;S(e,i,this.partialMode)}else if("application/json"===e&&t.status>=400){const e=await t.json();if("object"==typeof(i=e)&&i&&Object.prototype.hasOwnProperty.call(i,"title")&&Object.prototype.hasOwnProperty.call(i,"message")){const t=y("faceplate-alert",{level:b.error,name:e.title,message:l("Form responded with error"),meta:e.message});this.dispatchEvent(t)}}else"text/html"===e&&t.redirected&&(window.location.href=t.url);var i}};i([s({type:String})],J.prototype,"accept",void 0),i([s({type:String})],J.prototype,"enctype",void 0),i([s({type:String})],J.prototype,"action",void 0),i([s({type:Boolean,reflect:!0})],J.prototype,"disabled",void 0),i([s({converter:u,reflect:!0})],J.prototype,"method",void 0),i([s({type:String})],J.prototype,"target",void 0),i([s({type:String,attribute:"partial-mode"})],J.prototype,"partialMode",void 0),i([s({type:String})],J.prototype,"novalidate",void 0),i([s({type:String})],J.prototype,"credentials",void 0),J=i([p("faceplate-form")],J),A(J);export{$ as C,J as F,q as I,H as T,z as a,I as c,x as i,A as r};
